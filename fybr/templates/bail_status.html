<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bail Status Tracker - FIR #{{ application['fir_number'] }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        /* Base Styles */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --gray-color: #7f8c8d;
            --light-gray: #f5f7fa;
            --border-color: #e0e6ed;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Lato', sans-serif;
            line-height: 1.6;
            background-color: var(--light-gray);
            color: var(--dark-color);
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Merriweather', serif;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        a {
            text-decoration: none;
            color: var(--secondary-color);
            transition: all 0.3s ease;
        }
        
        a:hover {
            color: var(--primary-color);
        }
        
        /* Dashboard Layout */
        .dashboard-layout {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .dashboard-sidebar {
            width: 280px;
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            z-index: 100;
        }
        
        .sidebar-header {
            padding: 0 25px 25px;
            border-bottom: 1px solid var(--dark-color);
            margin-bottom: 20px;
        }
        
        .sidebar-header h3 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--light-color);
        }
        
        .sidebar-nav {
            padding: 20px 0;
        }
        
        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 14px 25px;
            color: var(--light-color);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            margin: 5px 0;
            font-size: 0.95rem;
        }
        
        .sidebar-nav a:hover {
            background-color: rgba(255,255,255,0.1);
            border-left: 3px solid var(--secondary-color);
            padding-left: 28px;
        }
        
        .sidebar-nav a.active {
            background-color: rgba(52, 152, 219, 0.2);
            border-left: 3px solid var(--secondary-color);
            font-weight: bold;
        }
        
        .sidebar-nav i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }
        
        .logout-link {
            color: var(--danger-color) !important;
            margin-top: 20px;
        }
        
        /* Main Content */
        .container {
            flex: 1;
            padding: 30px;
            background-color: var(--light-gray);
        }
        
        /* Tracker Header */
        .tracker-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .tracker-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .court-info {
            margin: 0;
            color: var(--gray-color);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .court-info i {
            color: var(--secondary-color);
        }
        
        /* Status Card */
        .status-card {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .status-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .status-card h2 {
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 1.5rem;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Status Indicator */
        .status-indicator {
            padding: 18px 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #f8f9fa;
            border-left: 4px solid #bdc3c7;
            transition: all 0.3s ease;
        }
        
        .status-label {
            font-weight: bold;
            color: var(--gray-color);
            font-size: 0.95rem;
        }
        
        .status-text {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .status-pending {
            border-left-color: var(--warning-color);
            background-color: #fef5e7;
        }
        
        .status-pending .status-text {
            color: var(--warning-color);
        }
        
        .status-approved {
            border-left-color: var(--success-color);
            background-color: #e8f8f0;
        }
        
        .status-approved .status-text {
            color: var(--success-color);
        }
        
        .status-rejected {
            border-left-color: var(--danger-color);
            background-color: #fdedec;
        }
        
        .status-rejected .status-text {
            color: var(--danger-color);
        }
        
        .status-under_review {
            border-left-color: var(--secondary-color);
            background-color: #ebf5fb;
        }
        
        .status-under_review .status-text {
            color: var(--secondary-color);
        }
        
        /* Legal Personnel Section */
        .legal-personnel {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .personnel-item {
            flex: 1;
            min-width: 200px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-color);
            transition: transform 0.3s ease;
        }
        
        .personnel-item:hover {
            transform: translateY(-5px);
        }
        
        .personnel-item h4 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .personnel-item p {
            margin: 0;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        /* Details Section */
        .details-section {
            margin-top: 30px;
        }
        
        .details-section h3 {
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .detail-item {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .detail-label {
            font-weight: bold;
            min-width: 200px;
            color: var(--primary-color);
        }
        
        .detail-value {
            flex: 1;
            color: var(--dark-color);
        }
        
        /* Status Messages */
        .status-message {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid var(--border-color);
        }
        
        .approved-message {
            border-left-color: var(--success-color);
            background-color: #e8f8f0;
        }
        
        .rejected-message {
            border-left-color: var(--danger-color);
            background-color: #fdedec;
        }
        
        .pending-message {
            border-left-color: var(--warning-color);
            background-color: #fef5e7;
        }
        
        .judge-comments, .advocate-review, .bail-details {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .judge-comments {
            border-left: 4px solid var(--secondary-color);
        }

        .advocate-review {
            border-left: 4px solid #9b59b6;
        }
        
        .bail-details {
            border-left: 4px solid var(--success-color);
            background-color: #e8f8f0;
        }
        
        .bail-amount {
            font-weight: bold;
            color: var(--success-color);
            font-size: 1.1rem;
        }
        
        /* Info Note */
        .info-note {
            padding: 18px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-color);
            color: var(--gray-color);
            margin: 20px 0;
        }
        
        .info-note i {
            color: var(--secondary-color);
            margin-right: 8px;
        }
        
        /* Download Button */
        .download-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 14px 28px;
            background-color: var(--success-color);
            color: white;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
            margin: 20px 0;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .download-btn:hover {
            background-color: #27ae60;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
        }
        
        .download-btn i {
            margin-right: 10px;
            font-size: 1.1rem;
        }
        
        /* Payment Section */
        .payment-section {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            max-width: 550px;
            margin: 30px auto;
            padding: 30px;
            border-left: 4px solid var(--secondary-color);
            transition: transform 0.3s ease;
        }
        
        .payment-section:hover {
            transform: translateY(-3px);
        }
        
        .payment-header {
            margin-bottom: 25px;
            text-align: center;
        }
        
        .payment-header h3 {
            margin: 0;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .payment-amount {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--success-color);
            margin: 15px 0;
            text-align: center;
        }
        
        .payment-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .payment-tab {
            flex: 1;
            text-align: center;
            padding: 14px;
            cursor: pointer;
            font-weight: bold;
            color: var(--gray-color);
            background-color: #f8f9fa;
            transition: all 0.3s ease;
        }
        
        .payment-tab:hover {
            color: var(--secondary-color);
        }
        
        .payment-tab.active {
            color: white;
            background-color: var(--secondary-color);
        }
        
        .payment-method {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .payment-method.active {
            display: block;
        }
        
        .payment-form {
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--primary-color);
            font-size: 0.95rem;
        }
        
        .payment-section input {
            transition: all 0.3s ease;
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: 'Lato', sans-serif;
            font-size: 1rem;
        }
        
        .payment-section input:focus {
            border-color: var(--secondary-color) !important;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .payment-section input.invalid {
            border-color: var(--danger-color);
        }
        
        .error-message {
            color: var(--danger-color);
            font-size: 0.85rem;
            margin-top: 8px;
            display: none;
        }
        
        .payment-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .payment-btn:hover {
            background-color: #27ae60;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
        }
        
        .payment-btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .payment-security {
            margin-top: 20px;
            font-size: 0.85rem;
            color: var(--gray-color);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .upi-apps {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .upi-app {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .upi-app:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .upi-app.active {
            border-color: var(--secondary-color);
        }
        
        .upi-app img {
            width: 36px;
            height: 36px;
            object-fit: contain;
        }
        
        .payment-terms {
            font-size: 0.8rem;
            color: var(--gray-color);
            text-align: center;
            margin-top: 20px;
            line-height: 1.5;
        }
        
        /* Footer */
        .tracker-footer {
            text-align: center;
            padding: 25px;
            color: var(--gray-color);
            font-size: 0.9rem;
            border-top: 1px solid var(--border-color);
            margin-top: 30px;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .dashboard-sidebar {
                width: 240px;
            }
            
            .container {
                padding: 25px;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-layout {
                flex-direction: column;
            }
            
            .dashboard-sidebar {
                width: 100%;
            }
            
            .container {
                padding: 20px;
            }
            
            .detail-item {
                flex-direction: column;
                gap: 5px;
            }
            
            .detail-label {
                min-width: 100%;
            }

            .legal-personnel {
                flex-direction: column;
                gap: 15px;
            }
            
            .personnel-item {
                min-width: 100%;
            }
            
            .payment-section {
                padding: 25px 20px;
            }
            
            .payment-tabs {
                flex-direction: column;
            }
            
            .payment-tab {
                padding: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .status-card, .payment-section {
                padding: 20px 15px;
            }
            
            .tracker-header h1 {
                font-size: 1.7rem;
            }
            
            .payment-header h3 {
                font-size: 1.2rem;
            }
            
            .payment-amount {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>

    <div class="dashboard-layout">
        <!-- Sidebar Navigation -->
        <aside class="dashboard-sidebar">
            <div class="sidebar-header">
                <h3>Bail Reckoner</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="{{ url_for('prisoner_dashboard') }}">
                   <i class="fas fa-tachometer-alt fa-fw"></i> Dashboard
                </a>
                <a href="{{ url_for('apply_for_bail') }}" class="active">
                    <i class="fas fa-file-signature fa-fw"></i> Apply for Bail
                </a>
                <a href="#">
                    <i class="fas fa-gavel fa-fw"></i> Case Information
                </a>
                <a href="{{ url_for('logout') }}" class="logout-link">
                    <i class="fas fa-sign-out-alt fa-fw"></i> Logout
                </a>
            </nav>
        </aside>

        <div class="container">
            <header class="tracker-header">
                <h1>Bail Application Tracking</h1>
                {% if application.get('court_info') %}
                <p class="court-info">
                    <i class="fas fa-balance-scale"></i> 
                    {{ application.court_info.court_type.title() }} of {{ application.court_info.district.title() }}, {{ application.court_info.state.title() }}
                </p>
                {% endif %}
            </header>

            <main class="tracker-content">
                <div class="status-card">
                    <h2><i class="fas fa-file-contract"></i> FIR #{{ application['fir_number'] }}</h2>

                    <!-- Status Indicator -->
                    <div class="status-indicator status-{{ application['status'] | lower | replace(' ', '_') }}">
                        <span class="status-label">Current Status:</span>
                        <span class="status-text">{{ application['status'] }}</span>
                    </div>

                    <!-- Details Section -->
                    <div class="details-section">
                        <h3><i class="fas fa-info-circle"></i> Application Details:</h3>
                        
                        <div class="detail-item">
                            <span class="detail-label">Full Name:</span>
                            <span class="detail-value">{{ application['full_name'] }}</span>
                        </div>

                        <div class="detail-item">
                            <span class="detail-label">IPC Section(s):</span>
                            <span class="detail-value">{{ application['primary_ipc'] }}</span>
                        </div>

                        <div class="detail-item">
                            <span class="detail-label">Offense:</span>
                            <span class="detail-value">{{ application['primary_offense'] }}</span>
                        </div>

                        <div class="detail-item">
                            <span class="detail-label">Bail Score:</span>
                            <span class="detail-value">{{ application['bail_score'] }}%</span>
                        </div>

                        <div class="detail-item">
                            <span class="detail-label">Reason for Application:</span>
                            <span class="detail-value">{{ application['reason'] }}</span>
                        </div>

                        <!-- Legal Advocate Review Section -->
                        {% if application.get('advocate_comments') %}
                        <div class="advocate-review">
                            <h4><i class="fas fa-user-tie"></i> Legal Advocate Review</h4>
                            <div class="detail-item">
                                <span class="detail-label">Advocate Name:</span>
                                <span class="detail-value">{{ application.get('advocate_name', 'N/A') }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Decision:</span>
                                <span class="detail-value">
                                    {% if application.get('advocate_decision') == 'reject' %}
                                        Recommended for Rejection
                                    {% else %}
                                        Forwarded to Judge
                                    {% endif %}
                                </span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Meets Eligibility:</span>
                                <span class="detail-value">{{ application.get('advocate_eligibility', 'N/A') }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Flight Risk:</span>
                                <span class="detail-value">{{ application.get('advocate_flight_risk', 'N/A') }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Comments:</span>
                                <span class="detail-value">{{ application['advocate_comments'] }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Reviewed by:</span>
                                <span class="detail-value">{{ application.get('advocate_name', 'N/A') }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Review Date:</span>
                                <span class="detail-value">
                                    {% if application['advocate_review_date'] is string %}
                                        {{ application['advocate_review_date'] }}
                                    {% else %}
                                        {{ application['advocate_review_date'].strftime('%Y-%m-%d %H:%M') }}
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Bail Approval Details - Only shown when status is Approved -->
                        {% if application['status'] == 'Approved' %}
                        <div class="bail-details">
                            <h4><i class="fas fa-check-circle"></i> Bail Approval Details</h4>
                            <div class="detail-item">
                                <span class="detail-label">Presiding Judge:</span>
                                <span class="detail-value">{{ application['judge_name'] }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Court:</span>
                                <span class="detail-value">
                                    {{ application.get('court_info', {}).get('court_type', 'N/A').title() }}  of 
                                    {{ application.get('court_info', {}).get('district', 'N/A').title() }}, 
                                    {{ application.get('court_info', {}).get('state', 'N/A').title() }}
                                </span>
                            </div>
                            {% if application.get('bail_amount') %}
                            <div class="detail-item">
                                <span class="detail-label">Bail Bond Amount:</span>
                                <span class="detail-value bail-amount">₹{{ "{:,.2f}".format(application['bail_amount']) }}</span>
                            </div>
                            {% endif %}
                            <div class="detail-item">
                                <span class="detail-label">Bail Conditions:</span>
                                <span class="detail-value" style="white-space: pre-line;">
                                    1. The prisoner must deposit the bail bond to the court within 2–3 days to initiate the release process.
                                    2. If the bail amount is paid within the given time, the court will issue a bail approval order signed by the judge.
                                    3. The prisoner must appear before the court on all scheduled hearing dates without fail, failing which the bail may be revoked.
                                    4. The prisoner must not leave the jurisdiction of the court without prior permission and must inform the court of any change in residence.
                                    5. The prisoner shall not attempt to contact, threaten, or influence any witnesses or tamper with evidence related to the case.
                                </span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Judge's Comments:</span>
                                <span class="detail-value">{{ application['judge_comments'] }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Decision Date:</span>
                                <span class="detail-value">
                                    {% if application['decision_date'] is string %}
                                        {{ application['decision_date'] }}
                                    {% else %}
                                        {{ application['decision_date'].strftime('%Y-%m-%d %H:%M') }}
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        {% elif application['status'] == 'Rejected' %}
                        <div class="detail-item status-message rejected-message">
                            <span class="detail-label">Outcome:</span>
                            <span class="detail-value">The application was rejected by the judge.</span>
                        </div>
                        <div class="detail-item judge-comments">
                            <span class="detail-label">Judge's Comments:</span>
                            <span class="detail-value">{{ application['judge_comments'] }}</span>
                        </div>
                        {% elif application['status'] in ['Pending', 'Under Review'] %}
                        <div class="detail-item status-message pending-message">
                            <span class="detail-label">Outcome:</span>
                            <span class="detail-value">The application is currently under review. Please check back later for updates.</span>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Document Download/Payment Section -->
                    <div class="document-download" style="margin-top: 30px; text-align: center;">
                        {% if application['status'] == 'Approved' %}
                            {% if application.get('payment_status') == 'paid' %}
                                {% if has_pdf %}
                                    <a href="{{ url_for('download_bail_approval', application_id=application._id) }}" class="download-btn">
                                        <i class="fas fa-file-pdf"></i> Download Bail Approval Order
                                    </a>
                                    <p style="margin-top: 10px; color: var(--gray-color); font-size: 0.9rem;">
                                        Official court document with judge's signature and seal
                                    </p>
                                    <div class="payment-details" style="margin-top: 20px; background-color: #f8f9fa; padding: 20px; border-radius: 8px; max-width: 500px; margin-left: auto; margin-right: auto;">
                                        <h4><i class="fas fa-receipt"></i> Payment Receipt</h4>
                                        <div class="detail-item">
                                            <span class="detail-label">Amount Paid:</span>
                                            <span class="detail-value bail-amount">₹{{ "{:,.2f}".format(application['bail_amount']) }}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Payment Date:</span>
                                            <span class="detail-value">
                                                {% if application.get('payment_date') is string %}
                                                    {{ application.get('payment_date', 'N/A') }}
                                                {% else %}
                                                    {{ application.get('payment_date').strftime('%Y-%m-%d %H:%M') if application.get('payment_date') else 'N/A' }}
                                                {% endif %}
                                            </span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Transaction ID:</span>
                                            <span class="detail-value">{{ application.get('transaction_id', 'DEMO-123456789') }}</span>
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="info-note">
                                        <i class="fas fa-info-circle"></i> Your payment has been received. The bail approval document is being processed and will be available soon.
                                    </div>
                                {% endif %}
                            {% else %}
                                <!-- Enhanced Payment Section -->
                                <div class="payment-section">
                                    <div class="payment-header">
                                        <h3><i class="fas fa-credit-card"></i> Pay Bail Bond</h3>
                                        <div class="payment-amount">₹{{ "{:,.2f}".format(application['bail_amount']) }}</div>
                                    </div>
                                    
                                    <div class="payment-tabs">
                                        <div class="payment-tab active" data-tab="card">Credit/Debit Card</div>
                                        <div class="payment-tab" data-tab="upi">UPI Payment</div>
                                    </div>
                                    
                                    <!-- Card Payment Method -->
                                    <div class="payment-method active" id="card-method">
                                        <form id="card-form" action="{{ url_for('process_payment', application_id=application._id) }}" method="POST">
                                            <div class="form-group">
                                                <label for="card-number">Card Number</label>
                                                <input type="text" id="card-number" placeholder="4242 4242 4242 4242" required 
                                                       pattern="[0-9]{16}" maxlength="16" onkeypress="return isNumberKey(event)">
                                                <div class="error-message" id="card-number-error">Please enter a valid 16-digit card number</div>
                                            </div>
                                            
                                            <div style="display: flex; gap: 15px;">
                                                <div class="form-group" style="flex: 1;">
                                                    <label for="expiry-date">Expiry Date</label>
                                                    <input type="text" id="expiry-date" placeholder="MM/YY" required 
                                                           pattern="(0[1-9]|1[0-2])\/[0-9]{2}" maxlength="5">
                                                    <div class="error-message" id="expiry-error">Please enter a valid expiry date (MM/YY)</div>
                                                </div>
                                                <div class="form-group" style="flex: 1;">
                                                    <label for="cvv">CVV</label>
                                                    <input type="text" id="cvv" placeholder="123" required 
                                                           pattern="[0-9]{3,4}" maxlength="4" onkeypress="return isNumberKey(event)">
                                                    <div class="error-message" id="cvv-error">Please enter a valid CVV (3-4 digits)</div>
                                                </div>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label for="card-name">Name on Card</label>
                                                <input type="text" id="card-name" placeholder="John Doe" required>
                                                <div class="error-message" id="name-error">Please enter the name as it appears on your card</div>
                                            </div>
                                            
                                            <button type="submit" class="payment-btn" id="card-pay-btn">
                                                <i class="fas fa-lock"></i> Pay ₹{{ "{:,.2f}".format(application['bail_amount']) }}
                                            </button>
                                        </form>
                                    </div>
                                    
                                    <!-- UPI Payment Method -->
                                    <div class="payment-method" id="upi-method">
                                        <form id="upi-form" action="{{ url_for('process_payment', application_id=application._id) }}" method="POST">
                                            <div class="form-group">
                                                <label for="upi-id">UPI ID</label>
                                                <input type="text" id="upi-id" placeholder="yourname@upi" required
                                                       pattern="[a-zA-Z0-9._-]+@[a-zA-Z0-9]+">
                                                <div class="error-message" id="upi-error">Please enter a valid UPI ID</div>
                                            </div>
                                            
                                            <div class="upi-apps">
                                                <div class="upi-app" data-upi="gpay">
                                                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Google_Pay_%28GPay%29_Logo.svg/512px-Google_Pay_%28GPay%29_Logo.svg.png" alt="Google Pay">
                                                </div>
                                                <div class="upi-app" data-upi="phonepe">
                                                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/PhonePe_Logo.svg/2560px-PhonePe_Logo.svg.png" alt="PhonePe">
                                                </div>
                                                <div class="upi-app" data-upi="paytm">
                                                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Paytm_logo.png/640px-Paytm_logo.png" alt="Paytm">
                                                </div>
                                                <div class="upi-app" data-upi="amazonpay">
                                                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a9/Amazon_logo.svg/2560px-Amazon_logo.svg.png" alt="Amazon Pay">
                                                </div>
                                            </div>
                                            
                                            <button type="submit" class="payment-btn" id="upi-pay-btn">
                                                <i class="fas fa-mobile-alt"></i> Pay via UPI
                                            </button>
                                        </form>
                                    </div>
                                    
                                    <div class="payment-security">
                                        <i class="fas fa-lock"></i> Secure payment encrypted with SSL technology
                                    </div>
                                    <div class="payment-terms">
                                        By proceeding, you agree to our Terms of Service and Privacy Policy
                                    </div>
                                </div>
                            {% endif %}
                        {% else %}
                            <div class="info-note">
                                <i class="fas fa-info-circle"></i> The bail approval document will be available after your application is approved.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </main>

            <footer class="tracker-footer">
                <p>© {{ current_year }} Court Information System | <a href="#">Help & Support</a></p>
            </footer>
        </div>
    </div>

    <script>
        // Payment Tab Switching
        document.querySelectorAll('.payment-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs and methods
                document.querySelectorAll('.payment-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding method
                this.classList.add('active');
                const tabId = this.getAttribute('data-tab');
                document.getElementById(`${tabId}-method`).classList.add('active');
            });
        });
        
        // UPI App Selection
        document.querySelectorAll('.upi-app').forEach(app => {
            app.addEventListener('click', function() {
                const upiProvider = this.getAttribute('data-upi');
                const upiIdField = document.getElementById('upi-id');
                
                // Remove active class from all apps
                document.querySelectorAll('.upi-app').forEach(a => a.classList.remove('active'));
                // Add active class to clicked app
                this.classList.add('active');
                
                // Set placeholder based on selected UPI app
                switch(upiProvider) {
                    case 'gpay':
                        upiIdField.placeholder = 'yourname@okicici';
                        break;
                    case 'phonepe':
                        upiIdField.placeholder = 'yourname@ybl';
                        break;
                    case 'paytm':
                        upiIdField.placeholder = 'yourname@paytm';
                        break;
                    case 'amazonpay':
                        upiIdField.placeholder = 'yourname@apl';
                        break;
                }
            });
        });
        
        // Form Validation Helpers
        function isNumberKey(evt) {
            const charCode = (evt.which) ? evt.which : evt.keyCode;
            return !(charCode > 31 && (charCode < 48 || charCode > 57));
        }
        
        function validateCardNumber(input) {
            const cardNumber = input.value.replace(/\s+/g, '');
            const errorElement = document.getElementById('card-number-error');
            
            if (cardNumber.length !== 16 || !/^\d+$/.test(cardNumber)) {
                input.classList.add('invalid');
                errorElement.style.display = 'block';
                return false;
            } else {
                input.classList.remove('invalid');
                errorElement.style.display = 'none';
                // Format with spaces every 4 digits
                input.value = cardNumber.replace(/(\d{4})(?=\d)/g, '$1 ');
                return true;
            }
        }
        
        function validateExpiryDate(input) {
            const value = input.value;
            const errorElement = document.getElementById('expiry-error');
            
            // Auto-insert slash after MM
            if (value.length === 2 && !value.includes('/')) {
                input.value = value + '/';
            }
            
            if (!/^(0[1-9]|1[0-2])\/\d{2}$/.test(value)) {
                input.classList.add('invalid');
                errorElement.style.display = 'block';
                return false;
            } else {
                input.classList.remove('invalid');
                errorElement.style.display = 'none';
                return true;
            }
        }
        
        function validateCVV(input) {
            const cvv = input.value;
            const errorElement = document.getElementById('cvv-error');
            
            if (cvv.length < 3 || !/^\d+$/.test(cvv)) {
                input.classList.add('invalid');
                errorElement.style.display = 'block';
                return false;
            } else {
                input.classList.remove('invalid');
                errorElement.style.display = 'none';
                return true;
            }
        }
        
        function validateName(input) {
            const name = input.value.trim();
            const errorElement = document.getElementById('name-error');
            
            if (name.length < 3 || /[^a-zA-Z\s]/.test(name)) {
                input.classList.add('invalid');
                errorElement.style.display = 'block';
                return false;
            } else {
                input.classList.remove('invalid');
                errorElement.style.display = 'none';
                return true;
            }
        }
        
        function validateUPI(input) {
            const upiId = input.value.trim();
            const errorElement = document.getElementById('upi-error');
            
            if (!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9]+$/.test(upiId)) {
                input.classList.add('invalid');
                errorElement.style.display = 'block';
                return false;
            } else {
                input.classList.remove('invalid');
                errorElement.style.display = 'none';
                return true;
            }
        }
        
        // Field Validation Event Listeners
        document.getElementById('card-number').addEventListener('input', function() {
            validateCardNumber(this);
        });
        
        document.getElementById('expiry-date').addEventListener('input', function() {
            validateExpiryDate(this);
        });
        
        document.getElementById('cvv').addEventListener('input', function() {
            validateCVV(this);
        });
        
        document.getElementById('card-name').addEventListener('input', function() {
            validateName(this);
        });
        
        document.getElementById('upi-id').addEventListener('input', function() {
            validateUPI(this);
        });
        
        // Form Submission Validation
        document.getElementById('card-form').addEventListener('submit', function(e) {
            let isValid = true;
            
            // Validate all card fields
            isValid &= validateCardNumber(document.getElementById('card-number'));
            isValid &= validateExpiryDate(document.getElementById('expiry-date'));
            isValid &= validateCVV(document.getElementById('cvv'));
            isValid &= validateName(document.getElementById('card-name'));
            
            if (!isValid) {
                e.preventDefault();
                alert('Please correct the errors in the form before submitting.');
            }
        });
        
        document.getElementById('upi-form').addEventListener('submit', function(e) {
            const upiId = document.getElementById('upi-id').value.trim();
            
            if (!validateUPI(document.getElementById('upi-id'))) {
                e.preventDefault();
                alert('Please enter a valid UPI ID before submitting.');
            }
        });
    </script>
</body>
</html>