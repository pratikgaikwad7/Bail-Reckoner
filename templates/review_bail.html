<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Bail Application</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --card-shadow: 0 10px 20px rgba(0,0,0,0.08);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7ff;
            color: var(--dark);
            line-height: 1.6;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--primary);
        }
        
        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
            color: var(--dark);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--secondary);
        }
        
        h2 {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }
        
        .application-card {
            background: white;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-family: 'Playfair Display', serif;
            color: var(--secondary);
            border-bottom: 1px solid #eee;
            padding-bottom: 0.5rem;
            margin: 2rem 0 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .detail-item {
            margin-bottom: 1rem;
        }
        
        .detail-label {
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .detail-value {
            padding: 0.8rem;
            background: var(--light);
            border-radius: 8px;
            border-left: 3px solid var(--primary);
        }
        
        .decision-form {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            margin-top: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--secondary);
        }
        
        select, textarea, input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        select:focus, textarea:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .btn {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            font-size: 1rem;
            margin-right: 1rem;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover {
            background: #d3164b;
        }
        
        .status-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }
        
        .status-pending {
            background-color: rgba(248, 150, 30, 0.1);
            color: var(--warning);
        }
        
        .status-approved {
            background-color: rgba(76, 201, 240, 0.1);
            color: var(--success);
        }
        
        .status-rejected {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--danger);
        }
        
        .bail-score {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .bail-score-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--secondary);
        }
        
        .bail-meter {
            flex-grow: 1;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger), var(--warning), var(--success));
        }
        
        .legal-decision {
            background: rgba(76, 201, 240, 0.1);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            border-left: 4px solid var(--success);
        }
        
        .legal-decision h4 {
            font-family: 'Playfair Display', serif;
            color: var(--secondary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .judge-decision {
            background: rgba(63, 55, 201, 0.1);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            border-left: 4px solid var(--secondary);
        }
        
        .bail-amount {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--success);
            background: rgba(76, 201, 240, 0.1);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            margin: 1rem 0;
        }
        
        .info-note {
            background-color: rgba(67, 97, 238, 0.1);
            padding: 0.8rem;
            border-radius: 8px;
            margin: 0.5rem 0;
            font-size: 0.9rem;
            border-left: 3px solid var(--primary);
        }
        
        @media (max-width: 768px) {
            .detail-grid {
                grid-template-columns: 1fr;
            }
            
            body {
                padding: 1rem;
            }
            
            .btn {
                display: block;
                width: 100%;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-gavel"></i> Review Bail Application</h1>
            <h2>Case #{{ application.fir_number }}</h2>
            <div class="status-badge 
                {% if application.status == 'Approved' %}status-approved
                {% elif application.status == 'Rejected' %}status-rejected
                {% else %}status-pending{% endif %}">
                <i class="fas 
                    {% if application.status == 'Approved' %}fa-check-circle
                    {% elif application.status == 'Rejected' %}fa-times-circle
                    {% else %}fa-clock{% endif %}"></i> 
                {{ application.status }}
            </div>
        </header>
        
        <div class="application-card">
            <div class="bail-score">
                <span class="bail-score-value">Bail Score: {{ application.bail_score }}%</span>
                <div class="bail-meter">
                    <div class="meter-fill" style="width: {{ application.bail_score }}%"></div>
                </div>
            </div>
            
            <!-- Display bail amount if approved -->
            {% if application.status == 'Approved' and application.bail_amount %}
            <div class="bail-amount">
                <i class="fas fa-money-bill-wave"></i> Bail Amount: ₹{{ "{:,.2f}".format(application.bail_amount) }}
                {% if application.primary_bailable == 'No' %}
                <div class="info-note">
                    <i class="fas fa-info-circle"></i> Note: Bail bond not normally applicable for non-bailable offenses (special circumstances)
                </div>
                {% endif %}
            </div>
            {% endif %}
            
            <!-- Legal Advocate Decision -->
            {% if application.advocate_comments %}
            <div class="legal-decision">
                <h4><i class="fas fa-user-tie"></i> Legal Advocate Recommendation</h4>
                <div class="detail-grid">
                    <div class="detail-item">
                        <span class="detail-label">Decision</span>
                        <div class="detail-value">
                            {{ 'Forwarded to Judge' if application.status == 'Pending Judge Review' else 'Recommended for Rejection' }}
                        </div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Meets Eligibility</span>
                        <div class="detail-value">{{ application.advocate_eligibility|capitalize }}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Flight Risk</span>
                        <div class="detail-value">{{ application.advocate_flight_risk|capitalize }}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Comments</span>
                        <div class="detail-value">{{ application.advocate_comments }}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Reviewed by</span>
                        <div class="detail-value">{{ application.advocate_name }}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Review Date</span>
                        <div class="detail-value">
                            {% if application.advocate_review_date is string %}
                                {{ application.advocate_review_date }}
                            {% else %}
                                {{ application.advocate_review_date.strftime('%Y-%m-%d %H:%M') }}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Judge Decision (if available) -->
            {% if application.judge_comments %}
            <div class="judge-decision">
                <h4><i class="fas fa-gavel"></i> Judge's Final Decision</h4>
                <div class="detail-grid">
                    <div class="detail-item">
                        <span class="detail-label">Decision</span>
                        <div class="detail-value">{{ application.status }}</div>
                    </div>
                    {% if application.bail_amount %}
                    <div class="detail-item">
                        <span class="detail-label">Bail Amount</span>
                        <div class="detail-value">₹{{ "{:,.2f}".format(application.bail_amount) }}</div>
                    </div>
                    {% endif %}
                    {% if application.bail_conditions %}
                    <div class="detail-item">
                        <span class="detail-label">Bail Conditions</span>
                        <div class="detail-value" style="white-space: pre-line;">{{ application.bail_conditions }}</div>
                    </div>
                    {% endif %}
                    <div class="detail-item">
                        <span class="detail-label">Comments</span>
                        <div class="detail-value">{{ application.judge_comments }}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Decided by</span>
                        <div class="detail-value">{{ application.judge_name }}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Decision Date</span>
                        <div class="detail-value">
                            {% if application.decision_date is string %}
                                {{ application.decision_date }}
                            {% else %}
                                {{ application.decision_date.strftime('%Y-%m-%d %H:%M') }}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <h3 class="section-title"><i class="fas fa-user"></i> Prisoner Details</h3>
            <div class="detail-grid">
                <div class="detail-item">
                    <span class="detail-label">Full Name</span>
                    <div class="detail-value">{{ application.full_name }}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Age</span>
                    <div class="detail-value">{{ application.age }}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Gender</span>
                    <div class="detail-value">{{ application.gender }}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ID Proof</span>
                    <div class="detail-value">{{ application.id_proof_type }}: {{ application.id_proof_number }}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Arrest Date</span>
                    <div class="detail-value">
                        {% if application.arrest_date is string %}
                            {{ application.arrest_date }}
                        {% else %}
                            {{ application.arrest_date.strftime('%Y-%m-%d') }}
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <h3 class="section-title"><i class="fas fa-home"></i> Residential Details</h3>
            <div class="detail-grid">
                <div class="detail-item">
                    <span class="detail-label">Address</span>
                    <div class="detail-value">{{ application.address }}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Residential Stability</span>
                    <div class="detail-value">{{ application.residential_stability }}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">District</span>
                    <div class="detail-value">{{ application.district }}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">State</span>
                    <div class="detail-value">{{ application.state }}</div>
                </div>
            </div>
            
            <h3 class="section-title"><i class="fas fa-balance-scale"></i> Case Details</h3>
            <div class="detail-grid">
                <div class="detail-item">
                    <span class="detail-label">Primary IPC Section</span>
                    <div class="detail-value">{{ application.primary_ipc }}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Primary Offense</span>
                    <div class="detail-value">{{ application.primary_offense }}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Bailable Offense</span>
                    <div class="detail-value">{{ application.primary_bailable }}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Cognizable Offense</span>
                    <div class="detail-value">{{ application.primary_cognizable }}</div>
                </div>
                {% if application.prior_record and application.prior_record.ipc_section %}
                <div class="detail-item">
                    <span class="detail-label">Prior Record</span>
                    <div class="detail-value">
                        {{ application.prior_record.ipc_section }} - {{ application.prior_record.offense }}
                    </div>
                </div>
                {% endif %}
            </div>
            
            <h3 class="section-title"><i class="fas fa-file-alt"></i> Application Details</h3>
            <div class="detail-item">
                <span class="detail-label">Reason for Bail</span>
                <div class="detail-value" style="white-space: pre-line;">{{ application.reason }}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Application Date</span>
                <div class="detail-value">
                    {% if application.application_date is string %}
                        {{ application.application_date }}
                    {% else %}
                        {{ application.application_date.strftime('%Y-%m-%d %H:%M') }}
                    {% endif %}
                </div>
            </div>
            
            <h3 class="section-title"><i class="fas fa-user-shield"></i> Bail Sureties</h3>
            {% for surety in application.sureties %}
            <div class="detail-grid">
                <div class="detail-item">
                    <span class="detail-label">{{ 'Primary' if surety.type == 'primary' else 'Secondary' }} Surety Name</span>
                    <div class="detail-value">{{ surety.name }}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Relationship</span>
                    <div class="detail-value">{{ surety.relation }}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Contact Number</span>
                    <div class="detail-value">{{ surety.phone }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        {% if application.status == 'Pending Judge Review' and current_user.role == 'Judge' %}
        <div class="decision-form">
            <h3 class="section-title"><i class="fas fa-clipboard-check"></i> Judge's Decision</h3>
            <form method="POST">
                <div class="form-group">
                    <label for="decision">Decision</label>
                    <select id="decision" name="decision" required>
                        <option value="" disabled selected>Select Decision</option>
                        <option value="approve">Approve Bail</option>
                        <option value="reject">Reject Bail</option>
                    </select>
                </div>
                
                <div class="form-group" id="bailAmountGroup" style="display: none;">
                    <label for="bail_amount">Bail Bond Amount (₹)</label>
                    <input type="number" id="bail_amount" name="bail_amount" 
                           min="0" step="0.01"
                           placeholder="Enter bail bond amount">
                </div>
                
                <div class="form-group" id="conditionsGroup" style="display: none;">
                    <label for="conditions">Bail Conditions</label>
                    <textarea id="conditions" name="conditions" 
                              placeholder="1. The prisoner must deposit the bail bond to the court within 2–3 days to initiate the release process.
2. If the bail amount is paid within the given time, the court will issue a bail approval order signed by the judge.
3. The prisoner must appear before the court on all scheduled hearing dates without fail, failing which the bail may be revoked.
4. The prisoner must not leave the jurisdiction of the court without prior permission and must inform the court of any change in residence.
5. The prisoner shall not attempt to contact, threaten, or influence any witnesses or tamper with evidence related to the case."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="comments">Decision Comments</label>
                    <textarea id="comments" name="comments" required 
                              placeholder="Provide detailed comments about your decision..."></textarea>
                </div>
                
                <button type="submit" class="btn">
                    <i class="fas fa-paper-plane"></i> Submit Decision
                </button>
                <a href="{{ url_for('judge_dashboard') }}" class="btn btn-danger">
                    <i class="fas fa-times"></i> Cancel
                </a>
            </form>
        </div>
        {% if application.status == 'Approved' %}
<div class="application-card">
    <h3 class="section-title"><i class="fas fa-file-pdf"></i> Bail Approval Document</h3>
    <div class="detail-item">
        <p>The official bail approval document is available for download:</p>
        <a href="{{ url_for('download_bail_approval', application_id=application._id) }}" 
           class="btn" target="_blank">
            <i class="fas fa-download"></i> Download Bail Approval PDF
        </a>
    </div>
</div>
{% endif %}
        
        <script>
            document.getElementById('decision').addEventListener('change', function() {
                const bailAmountGroup = document.getElementById('bailAmountGroup');
                const conditionsGroup = document.getElementById('conditionsGroup');
                
                if (this.value === 'approve') {
                    bailAmountGroup.style.display = 'block';
                    conditionsGroup.style.display = 'block';
                } else {
                    bailAmountGroup.style.display = 'none';
                    conditionsGroup.style.display = 'none';
                }
            });
        </script>
        {% endif %}
    </div>
</body>
</html>